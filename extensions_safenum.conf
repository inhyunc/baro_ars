; ********************************************************************************
; *                                                                              *
; * 안심번호 서비스                                                              *
; *                                                                              *
; ********************************************************************************

[safenum_main]

exten => _X.,1, Noop([safe_main] Recv Call [${CALLERID(ANI)} --> ${CALLERID(DNID)}] From [${CHANNEL(peerip)}])

	same => n, Ringing()
	same => n, Set(CALLER=${CALLERID(ANI)})
	same => n, Set(CALLEE=${CALLERID(DNID)})

	same => n, Set(CHANNEL(language)=kr)

	same => n, Set(agiPath=/var/lib/asterisk/agi-bin/${agiDIR})
	same => n, Set(agiDIR=safenum)
	same => n, Set(wavDIR=safenum)

	same => n, Set(countWRONG=0)
	same => n, Set(countENTER=0)
	same => n, Set(countAUTH=0)

	same => n, Set(m_RegCount=0)
	same => n, Set(m_0507_DN0=)
	same => n, Set(m_0507_DN1=)
	same => n, Set(m_0507_DN2=)
	same => n, Set(m_0507_DN3=)
	same => n, Set(m_0507_DN4=)
	same => n, Set(m_0507_DN5=)
	same => n, Set(m_0507_DN6=)
	same => n, Set(m_0507_DN7=)
	same => n, Set(m_0507_DN8=)
	same => n, Set(m_0507_DN9=)

	same => n, Set(m_MainMenuCallType=1)

	same => n, Answer()



	; ********************************************************************************
	;                                                                                *
	; 1. 도입부                                                                      *
	;                                                                                *
	; ********************************************************************************

	; ---------------------------------------+
	; 1.1 Greeting Message(인사말)           |
	; ---------------------------------------+
	same => n(S11_greeting), Set(ErrorCode=S11_greeting)
	same => n, Playback(${wavDIR}/SAFE_001)					; 안녕하세요. 바로 안심 번호 서비스입니다.

	; ---------------------------------------+
	; 1.2 사용자 정보 검색                   |
	; ---------------------------------------+
	same => n(S12_getuserinfo), Set(ErrorCode=S12_getuserinfo)
	same => n, Set(countLOOP=1)
	same => n, GoSub(safe_agi_GetUserInfo,s,1(${ErrorCode},1))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 0]?S2_main)				; 미등록 가입자 -> 등록 메뉴
	same => n, GotoIf($[${rValue} = 1]?S13_single_number)			; 안심 번호 1개 사용 고객
	same => n, GotoIf($[${rValue} = 2]?S14_multi_number)			; 안심 번호 1개 이상  사용 고객
	same => n, Goto(safe_Finish,1)

	; ---------------------------------------+
	; 1.3 0507 번호 선택                     |
	; ---------------------------------------+
	same => n(S13_single_number), Set(ErrorCode=S13_single_number)
	same => n, Set(m_0507_Number=${m_0507_DN0})
	same => n, Goto(S3_main)

	same => n(S14_multi_number), Set(ErrorCode=S14_multi_number)
	same => n, Set(m_MainMenuCallType=2)
	same => n, Set(m_0507_Number=${m_0507_DN0})
	same => n, GoSub(safe_SelSafeNumber,s,1(${ErrorCode},${m_RegCount},${m_0507_Number}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S3_main)				; // 메인 메뉴로 이동
	same => n, Goto(safe_Finish,1)



	; ********************************************************************************
	;                                                                                *
	; 2. 등록 메뉴                                                                   *
	;                                                                                *
	; ********************************************************************************
	same => n(S2_main), Set(ErrorCode=S2_main)
;	same => n, GoSub(safe_SelRegMenu,s,1(${ErrorCode}))
;	same => n, Set(rValue=${GOSUB_RETVAL})
;	same => n, GotoIf($[${rValue} = 1]?S8_main)				; // 안심번호 등록
;	same => n, GotoIf($[${rValue} = 2]?S10_main)				; // 상담원 연결

	same => n, Goto(S8_main)						; // "안심번호 등록"으로 자동 이동
	same => n, Goto(safe_GoodBye,1)



	; ********************************************************************************
	;                                                                                *
	; 3. 메인 메뉴                                                                   *
	;                                                                                *
	; ********************************************************************************
	same => n(S3_main), Set(ErrorCode=S3_main)
	same => n, GoSub(safe_SelMainMenu,s,1(${ErrorCode},${m_RegCount},${m_0507_Number},${m_MainMenuCallType}))
	same => n, Set(m_MainMenuCallType=1)
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S4_main)				; // 관리 안내
	same => n, GotoIf($[${rValue} = 2]?S8_main)				; // 안심번호 등록
	same => n, GotoIf($[${rValue} = 3]?S9_main)				; // 안심번호 해지
	same => n, Goto(safe_Finish,1)



	; ********************************************************************************
	;                                                                                *
	; 4. 관리 안내                                                                   *
	;                                                                                *
	; ********************************************************************************
	same => n(S4_main), Set(ErrorCode=S4_main)

	; ---------------------------------------+
	; 4.1 0507 번호 정보 검색                |
	; ---------------------------------------+
;	same => n(S41_search_0507), Set(ErrorCode=S41_search_0507)
	same => n, GoSub(safe_agi_Get_0507_Info,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S43_ManageMenu)			; // succ -> 관리메뉴안내로 이동
	same => n, GotoIf($[${rValue} = 2]?S42_anmNotPay)			; // 미결제 정보 있음
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 4.2 미결제 안내                        |
	; ---------------------------------------+
	same => n(S42_anmNotPay), Set(ErrorCode=S42_anmNotPay)
	same => n, GoSub(safe_AnmNotPay,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 0]?S3_main)				; // 이전 단계(=메인메뉴)
	same => n, GotoIf($[${rValue} = 1]?S4_main)				; // 관리 메뉴 안내
	same => n, GotoIf($[${rValue} = 2]?S44_sendSMS)				; // 결제 문자 받기
	same => n, GotoIf($[${rValue} = 3]?S10_main)				; // 상담원 연결
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 4.3 관리 메뉴 안내                     |
	; ---------------------------------------+
	same => n(S43_ManageMenu), Set(ErrorCode=S43_ManageMenu)
	same => n, GoSub(safe_SelManageGuide,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 0]?S3_main)				; // 이전 단계(=메인 메뉴)
	same => n, GotoIf($[${rValue} = 1]?S5_main)				; // 착신 번호 변경
	same => n, GotoIf($[${rValue} = 2]?S6_main)				; // 안심 서비스 일시 정지
	same => n, GotoIf($[${rValue} = 3]?S7_main)				; // 안심 서비스 재개
	same => n, GotoIf($[${rValue} = 4]?S10_main)				; // 상담원 연결
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 4.4 결제 안내 문자 보내기              |
	; ---------------------------------------+
	same => n(S44_sendSMS), Set(ErrorCode=S44_sendSMS)
	same => n, GoSub(safe_agi_send_sms_pay,s,1(${ErrorCode}))
	same => n, Goto(safe_GoodBye,1)



	; ********************************************************************************
	;                                                                                *
	; 5. 착신 번호 변경                                                              *
	;                                                                                *
	; ********************************************************************************
	same => n(S5_main), Set(ErrorCode=S5_main)

	; ---------------------------------------+
	; 5.1 착신 번호 입력                     |
	; ---------------------------------------+
	same => n(S51_process), Set(ErrorCode=S51_process)
	same => n, GoSub(safe_changeCfaDN,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 0]?S4_main)				; // 이전 단계(=관리 메뉴)
	same => n, GotoIf($[${rValue} = 1]?S52_process)				; // 착신 번호 저장 & CallMix 번호 저장
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 5.2 착신 번호 변경 저장                |
	; ---------------------------------------+
	same => n(S52_process), Set(ErrorCode=S52_process)
	same => n, GoSub(safe_agi_storeCfaDN,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S53_NextWork)
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 5.3 계속 진행 여부 확인                |
	; ---------------------------------------+
	same => n(S53_NextWork), Set(ErrorCode=S53_NextWork)
	same => n, GoSub(safe_agi_GetUserInfo,s,1(${ErrorCode},2))		; // 등록 정보 가져오기
	same => n, GoSub(safe_Continue,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S4_main)				; // 안심번호 1개 사용 고객
	same => n, GotoIf($[${rValue} = 2]?S4_main)				; // 안심번호 2개 이상 사용 고객
	same => n, Goto(safe_GoodBye,1)



	; ********************************************************************************
	;                                                                                *
	; 6. 서비스 일시 정지                                                            *
	;                                                                                *
	; ********************************************************************************
	same => n(S6_main), Set(ErrorCode=S6_main)

	; ---------------------------------------+
	; 6.1 서비스 메뉴 안내                   |
	; ---------------------------------------+
	same => n(S62_process), Set(ErrorCode=S62_process)
	same => n, GoSub(safe_MenuInhCFA,s,1(${ErrorCode}))
	same => n, Set(RESULT=${GOSUB_RETVAL})
	same => n, GotoIf($[${RESULT} = 0]?S4_main)				; // 이전 단계(=관리 메뉴)
	same => n, GotoIf($[${RESULT} = 1]?S63_storeInfo)			; // 정지 정보 저장 & CallMix 정지 정보 저장
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 6.2 정지 정보 저장                     |
	; ---------------------------------------+
	same => n(S63_storeInfo), Set(ErrorCode=S63_storeInfo)
	same => n, GoSub(safe_agi_changeLinkYN,s,1(${ErrorCode},5))
	same => n, Set(RESULT=${GOSUB_RETVAL})
	same => n, GotoIf($[${RESULT} = 1]?S63_NextWork)
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 6.3 계속 진행 여부 확인                |
	; ---------------------------------------+
	same => n(S63_NextWork), Set(ErrorCode=S63_NextWork)
	same => n, GoSub(safe_AnmLinkAlwInh,s,1(${ErrCode}))
	same => n, GoSub(safe_Continue,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S4_main)				; // 안심번호 1개 사용 고객
	same => n, GotoIf($[${rValue} = 2]?S4_main)				; // 안심번호 2개 이상 사용 고객
	same => n, Goto(safe_GoodBye,1)



	; ********************************************************************************
	;                                                                                *
	; 7. 서비스 재개                                                                 *
	;                                                                                *
	; ********************************************************************************
	same => n(S7_main), Set(ErrorCode=S7_main)

	; ---------------------------------------+
	; 7.1 서비스 메뉴 안내                   |
	; ---------------------------------------+
	same => n(S71_anmMenu), Set(ErrorCode=S71_anmMenu)
	same => n, GoSub(safe_MenuAlwCFA,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 0]?S4_main)				; // 이전 단계(=관리 메뉴)
	same => n, GotoIf($[${rValue} = 1]?S72_storeInfo)			; // 허용 정보 저장 & CallMix 허용 정보 저장
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 7.2 허용 정보 저장                     |
	; ---------------------------------------+
	same => n(S72_storeInfo), Set(ErrorCode=S72_storeInfo)
	same => n, Set(m_CFA_LinkYN=Y)
	same => n, GoSub(safe_agi_changeLinkYN,s,1(${ErrorCode},4))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S73_NextWork)
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 7.3 계속 진행 여부 확인                |
	; ---------------------------------------+
	same => n(S73_NextWork), Set(ErrorCode=S73_NextWork)
	same => n, GoSub(safe_AnmLinkAlwInh,s,1(${ErrCode}))
	same => n, GoSub(safe_Continue,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S4_main)				; // 안심번호 1개 사용 고객
	same => n, GotoIf($[${rValue} = 2]?S4_main)				; // 안심번호 2개 이상 사용 고객
	same => n, Goto(safe_GoodBye,1)



	; ********************************************************************************
	;                                                                                *
	; 8. 안심 번호 등록                                                              *
	;                                                                                *
	; ********************************************************************************
	same => n(S8_main), Set(ErrorCode=S8_main)

	; ---------------------------------------+
	; 8.1 안심번호 등록 메뉴 안내            |
	; ---------------------------------------+
	same => n(S81_anmMenu), Set(ErrorCode=S81_anmMenu)
	same => n, GoSub(safe_menu_RegSafeNumber,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 0]?S3_main)				; // 이전 단계(=메인 메뉴)
	same => n, GotoIf($[${rValue} = 1]?S82_reserv_0507)			; // 0507 번호 등록 예약
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 8.2 0507 번호 등록 예약 하기           |
	; ---------------------------------------+
	same => n(S82_reserv_0507), Set(ErrorCode=S82_reserv_0507)
	same => n, GoSub(safe_agi_reserv_0507,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S83_get_0507)
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 8.3 착신 전환 서비스 번호 입력         |
	; ---------------------------------------+
	same => n(S83_get_0507), Set(ErrorCode=S83_get_0507)
	same => n, Playback(${wavDIR}/SAFE_033)					; 착신 전환 번호 입력 단계입니다.
	same => n, GoSub(safe_changeCfaDN,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S84_regSafeNumber)			; // 안심 번호 등록

	same => n, GoSub(safenum_cancel_reserv0507,s,1(${ErrorCode}))		; // 안심번호 예약 정보 취소

	same => n, GotoIf($[${m_RegCount} = 0]?safe_GoodBye,1)
	same => n, GotoIf($[${rValue} = 0]?S3_main)				; // 이전 단계(=메인 메뉴)
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 8.4 안심 번호 등록                     |
	; ---------------------------------------+
	same => n(S84_regSafeNumber), Set(ErrorCode=S84_regSafeNumber)
	same => n, Set(m_CFA_LinkYN=N)
	same => n, GoSub(safe_agi_regSafeNumber,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S85_sendSMS)				; // 결제 안내 문자 보내기

	same => n, GoSub(safenum_cancel_reserv0507,s,1(${ErrorCode}))		; // 안심번호 예약 정보 취소
	same => n, GotoIf($[${m_RegCount} = 0]?safe_GoodBye,1)

	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 8.5 결제 안내 문자 보내기              |
	; ---------------------------------------+
	same => n(S85_sendSMS), Set(ErrorCode=S85_sendSMS)
	same => n, GoSub(safe_agi_send_sms_pay,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S86_NextWork)			; // succ
	same => n, GotoIf($[${rValue} = 2]?S86_NextWork)			; // fail
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 8.6 결제 안내 문자 보내기              |
	; ---------------------------------------+
	same => n(S86_NextWork), Set(ErrorCode=S86_NextWork)
	same => n, GoSub(safe_agi_GetUserInfo,s,1(${ErrorCode},2))		; // 등록 정보 가져오기
	same => n, GoSub(safe_Continue,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 0]?S2_main)				; // 안심번호 없는 고객
	same => n, GotoIf($[${rValue} = 1]?S3_main)				; // 안심번호 1개 사용 고객
	same => n, GotoIf($[${rValue} = 2]?S3_main)				; // 안심번호 2개 이상 사용 고객
	same => n, Goto(safe_GoodBye,1)



	; ********************************************************************************
	;                                                                                *
	; 9. 안심 번호 해지                                                              *
	;                                                                                *
	; ********************************************************************************
	same => n(S9_main), Set(ErrorCode=S9_main)

	; ---------------------------------------+
	; 9.1 안심 번호 해지 메뉴                |
	; ---------------------------------------+
	same => n, GoSub(safe_menu_UnregSafeNumber,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 0]?S3_main)				; // 이전 단계
	same => n, GotoIf($[${rValue} = 1]?S92_unregSafeNumber)			; // 안심 번호 서비스 해지
	same => n, GotoIf($[${rValue} = 2]?S9_main)				; // 안심 번호 서비스 등록으로 이동
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 9.2 안심 번호 서비스 해지              |
	; ---------------------------------------+
	same => n(S92_unregSafeNumber), Set(ErrorCode=S92_unregSafeNumber)
	same => n, GoSub(safe_agi_unregSafeNumber,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S93_NextWork)			; // 안심 번호 등록
	same => n, Goto(safe_GoodBye,1)

	; ---------------------------------------+
	; 9.3 다음 작업 준비                     |
	; ---------------------------------------+
	same => n(S93_NextWork), Set(ErrorCode=S93_NextWork)
	same => n, GoSub(safe_agi_GetUserInfo,s,1(${ErrorCode},2))		; // 등록 정보 가져오기
	same => n, GoSub(safe_Continue,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 0]?S2_main)				; // 안심번호 없는 고객
	same => n, GotoIf($[${rValue} = 1]?S3_main)				; // 안심번호 1개 사용 고객
	same => n, GotoIf($[${rValue} = 2]?S3_main)				; // 안심번호 2개 이상 사용 고객
	same => n, Goto(safe_GoodBye,1)



	; ********************************************************************************
	;                                                                                *
	; 10. 상담원 연결                                                                *
	;                                                                                *
	; ********************************************************************************
	same => n(S10_main), Set(ErrorCode=S10_main)
	same => n, GoSub(safe_agi_get_callcenterDN,s,1(${ErrorCode}))
	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, GotoIf($[${rValue} = 1]?S101_Conn)				; // 콜센터 번호 있음
	same => n, GotoIf($[${rValue} = 2]?S102_Sorry)				; // 콜센터 번호 미지정
	same => n, Goto(safe_GoodBye,1)

	same => n(S101_Conn), Set(ErrorCode=S101_Conn)
	same => n, Dial(SIP/${RDN}/${m_ConsultantDN})
	same => n, Goto(safe_GoodBye,1)

	same => n(S102_Sorry), Set(ErrorCode=S102_Sorry)
	same => n, Playback(${wavDIR}/SAFE_E05)					; 죄송합니다. 상담원이 지정되어 있지 않아,
	                                       					; 연결하지 못합니다.
	same => n, Goto(safe_GoodBye,1)



	; ********************************************************************************
	;                                                                                *
	;                                                                                *
	;                                                                                *
	; ********************************************************************************
exten => safe_GoodBye, 1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_main/safe_GoodBye ERR=[${ErrorCode}])
	same => n, Playback(${wavDIR}/SAFE_060)			; 이용해 주셔서 감사합니다.
	same => n, Hangup()

exten => safe_Finish, 1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_main/safe_Finish ERR=[${ErrorCode}])
	same => n, Hangup()

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_main/Hangup ERR=[${ErrorCode}])
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;   0507 번호를 KEY값으로 하여 다우로 착신전환 정보 저장 요청                    *
;   callmix_store_cfa_dn.php                                                     *
;      (1) input : - m_0507_Number                                               *
;                  - m_CFA_Number                                                *
;                  - m_CFA_LinkYN                                                *
;      (2) output: - RESULT(1111=succ,4444=fail)                                 *
;                                                                                *
; ********************************************************************************

[safe_dau_store_SafeNumber]
exten => s,1,Noop(safe_dau_store_SafeNumber from [${ARG1}/${ARG2}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})		; ErrCode
	same => n, Set(LOCAL(CallTyp)=${ARG2})		; 1=등록,2=해지,3=착신번호변경,4=착신활성화,5=착신비활성화

	; ----------------------------------------
	; CallMix에 저장하기                      
	; ----------------------------------------
	same => n(SDSS_dau_agi), Set(ErrCode=SDSS_dau_agi)
	same => n, AGI(${agiDIR}/callmix_store_cfa_dn.php)
	same => n, Log(NOTICE,[${CALLER}] callmix_store_cfa_dn.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_0507_Number=[${m_0507_Number}] m_CFA_Number=[${m_CFA_Number}] m_CFA_LinkYN=[${m_CFA_LinkYN}] )

	same => n, GoSubIf($["${AGISTATUS}"!="SUCCESS"]?comm_PlayErrMesg,s,1(SDSS_dau_fail,SAFE_E01,0))
	same => n, GotoIf($["${RESULT}" = "1111"]?SDSS_dau_succ)		; // succ
	same => n, GotoIf($["${RESULT}" = "4444"]?SDSS_dau_fail)		; // fail
	same => n, GoSub(comm_PlayErrMesg,s,1(SDSS_dau_define,SAFE_E02,1))

	same => n(SDSS_dau_succ), Set(ErrCode=SDSS_dau_succ)
	same => n, ExecIf($[${CallTyp} = 1}]?Playback(${wavDIR}/SAFE_035))	; 안심 번호 서비스가 등록되었습니다.
	same => n, ExecIf($[${CallTyp} = 2}]?Playback(${wavDIR}/SAFE_036))	; 안심 번호 서비스가 해지되었습니다.
	same => n, ExecIf($[${CallTyp} = 3}]?Playback(${wavDIR}/SAFE_037))	; 착신 번호가 변경되었습니다.
	same => n, ExecIf($[${CallTyp} = 4}]?Playback(${wavDIR}/SAFE_038))	; 착신 링크가 활성화되었습니다.
	same => n, ExecIf($[${CallTyp} = 5}]?Playback(${wavDIR}/SAFE_039))	; 착신 링크가 오프되었습니다.
	same => n, Goto(SDSS_1)

	same => n(SDSS_dau_fail), Set(ErrCode=SDSS_dau_fail)
	same => n, ExecIf($[${CallTyp} = 1}]?Playback(${wavDIR}/SAFE_110))	; 다우 DB에 안심번호를 등록하지 못했습니다.
	same => n, ExecIf($[${CallTyp} = 2}]?Playback(${wavDIR}/SAFE_111))	; 다우 DB에 안심번호 서비스를 해지하지 못했습니다.
	same => n, ExecIf($[${CallTyp} = 3}]?Playback(${wavDIR}/SAFE_112))	; 다우 DB에 착신번호를 변경하지 못했습니다.
	same => n, ExecIf($[${CallTyp} = 4}]?Playback(${wavDIR}/SAFE_113))	; 다우 DB에 착신링크를 활성화하지 못했습니다.
	same => n, ExecIf($[${CallTyp} = 5}]?Playback(${wavDIR}/SAFE_114))	; 다우 DB에 착신 링크를 오프하지 못했습니다.

	same => n, Playback(${wavDIR}/SAFE_C07)					; 상담원에게 문의하시기 바랍니다.
	same => n, Goto(SDSS_9)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SDSS_1), Return(1)	; // succ
	same => n(SDSS_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_dau_store_SafeNumber/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;  바로 DB에서 고객이 등록하여 사용중인 안심번호 정보 조회                       *
;      safenum_get_user_info.php                                                 *
;      (1) input : - 발신번호                                                    *
;      (2) output: - RESULT(1111=OK,2222=미등록고객)                             *
;                  - m_RegCount                                                  *
;                  - m_0507_DN0 ~ m_0507_DN9                                     *
;                                                                                *
; ********************************************************************************

[safe_agi_GetUserInfo]
exten => s,1,Noop(safe_agi_GetUserInfo from [${ARG1}/${ARG2}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})
	same => n, Set(LOCAL(CallTyp)=${ARG2})		; // 1=ARS 시작후 최초 호출, 2=등록정보 가져오기

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_get_user_info.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_get_user_info.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_RegCount=[${m_RegCount}])

	same => n, GoSubIf($["${AGISTATUS}"!="SUCCESS"]?comm_PlayErrMesg,s,1(SGUI_agi_fail,SAFE_E01,0))
	same => n, GotoIf($[${RESULT} = 1111]?SGUI_succ)			; // succ
	same => n, GotoIf($[${RESULT} = 2222]?SGUI_unreg)			; // 미등록 가입자
	same => n, GoSub(comm_PlayErrMesg,s,1(SGUI_not_define,SAFE_E02,1))

	same => n(SGUI_succ), Set(ErrCode=SGUI_succ)
	same => n, GotoIf($[${m_RegCount} == 0]?SGUI_unreg)
	same => n, GotoIf($[${m_RegCount} == 1]?SGUI_suser:SGUI_muser)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SGUI_unreg), Set(ErrCode=SGUI_unreg)
	same => n, ExecIf($[${CallTyp} = 1]?Playback(${wavDIR}/SAFE_030))	; 등록된 가입자가 아닙니다.
	                                                   			; 등록 메뉴로 이동하겠습니다.
	same => n, Goto(SGUI_none)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SGUI_none),  Return(0)	; // 미등록 가입자
	same => n(SGUI_suser), Return(1)	; // 등록 갯수 = 1개
	same => n(SGUI_muser), Return(2)	; // 등록 갯수 = 1개 이상


exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_GetUserInfo/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;  바로 DB에서 0507 번호에 대한 착신 전환 정보 조회                              *
;      safenum_get_0507.php                                                      *
;      (1) input : - 발신번호                                                    *
;                  - m_0507_Number                                               *
;      (2) output: - RESULT(1111=OK,3333=NotPay)                                 *
;                  - m_CFA_Number                                                *
;                  - m_CFA_LinkYN                                                *
;                                                                                *
; ********************************************************************************

[safe_agi_Get_0507_Info]
exten => s,1,Noop(safe_agi_Get_0507_Info from [${ARG1}/${ARG2}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_get_0507.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_get_0507.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_0507_Number=[${m_0507_Number}] m_CFA_Number=[${m_CFA_Number}] m_CFA_LinkYN=[${m_CFA_LinkYN}] )

	same => n, GoSubIf($["${AGISTATUS}"!="SUCCESS"]?comm_PlayErrMesg,s,1(SG0I_agi_fail,SAFE_E01,0))
	same => n, GotoIf($[${RESULT} = 1111]?SG0I_1)			; // succ
	same => n, GotoIf($[${RESULT} = 3333]?SG0I_2)			; // 0507번호 미결제 상태임
	same => n, GoSub(comm_PlayErrMesg,s,1(SG0I_not_define,SAFE_E02,1))

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SG0I_1), Return(1)	; // succ
	same => n(SG0I_2), Return(2)	; // 미결제 안심번호

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_Get_0507_Info/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;   착신번호 변경 저장                                                           *
;   1. 바로 DB에 저장                                                            *
;      safenum_store_cfa_dn.php                                                  *
;      (1) input : - 발신번호                                                    *
;                  - m_0507_Number                                               *
;                  - m_CFA_Number                                                *
;      (2) output: - RESULT(1111=succ,4444=fail)                                 *
;                                                                                *
;   2. 다우 DB에 저장                                                            *
;                                                                                *
; ********************************************************************************

[safe_agi_storeCfaDN]
exten => s,1,Noop(safe_agi_storeCfaDN from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})			; ErrCode

	; ----------------------------------------
	; 바로 DB에 저장하기                             
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_store_cfa_dn.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_store_cfa_dn.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_0507_Number=[${m_0507_Number}] m_CFA_Number=[${m_CFA_Number}] )

	same => n, GoSubIf($["${AGISTATUS}"!="SUCCESS"]?comm_PlayErrMesg,s,1(SASC_agi_fail,SAFE_E01,0))
	same => n, GotoIf($["${RESULT}" = "1111"]?SASC_baro_succ)		; // succ
	same => n, GotoIf($["${RESULT}" = "4444"]?SASC_baro_fail)		; // fail
	same => n, GoSub(comm_PlayErrMesg,s,1(SASC_not_define,SAFE_E02,1))

	same => n(SASC_baro_succ), Set(ErrCode=SASC_baro_succ)
	same => n, Goto(SASC_dau_agi)

	same => n(SASC_baro_fail), Set(ErrCode=SASC_baro_fail)
	same => n, Playback(${wavDIR}/SAFE_102)					; 바로 DB에 착신번호를 변경하지 못했습니다. 
	same => n, Playback(${wavDIR}/SAFE_040)					; 상담원에게 문의하시기 바랍니다.
	same => n, Goto(SASC_9)

	; ----------------------------------------
	; 다우 DB에 저장하기                      
	; ----------------------------------------
	same => n(SASC_dau_agi), Set(ErrCode=SASC_dau_agi)
	same => n, GoSub(safe_dau_store_SafeNumber,s,1(${ErrCode},3))		; 3=착신번호변경
	same => n, Set(RESULT=${GOSUB_RETVAL})
	same => n, GotoIf($[${RESULT} = 1]?SASC_1:SASC_9)			; // if succ then SASC_1 else SASC_9

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SASC_1), Return(1)	; // succ
	same => n(SASC_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_storeCfaDN/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;  0507 번호를 key값으로 하여 착신전환 사용 flag를 저장                          *
;   1. 바로 DB에 저장                                                            *
;      safenum_change_linkYN.php                                                 *
;      (1) input : - 발신번호                                                    *
;                  - m_0507_Number                                               *
;                  - m_CFA_Number                                                *
;                  - m_CFA_LinkYN                                                *
;      (2) output: - RESULT(1111=succ,4444=fail)                                 *
;                                                                                *
;   2. 다우 DB에 저장                                                            *
;                                                                                *
; ********************************************************************************

[safe_agi_changeLinkYN]
exten => s,1,Noop(safe_agi_changeLinkYN from [${ARG1}/${ARG2}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})			; ErrCode
	same => n, Set(LOCAL(ActType)=${ARG2})			; ActType(4=착신활성화,5=착신비활성화)

	; ----------------------------------------
	; 바로 DB에 저장하기                             
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_change_linkYN.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_change_linkYN.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_0507_Number=[${m_0507_Number}] m_CFA_Number=[${m_CFA_Number}] m_CFA_LinkYN=[${m_CFA_LinkYN}] )

	same => n, GoSubIf($["${AGISTATUS}"!="SUCCESS"]?comm_PlayErrMesg,s,1(SACL_agi_fail,SAFE_E01,0))
	same => n, GotoIf($["${RESULT}" = "1111"]?SACL_baro_succ)		; // succ
	same => n, GotoIf($["${RESULT}" = "4444"]?SACL_baro_fail)		; // fail
	same => n, GoSub(comm_PlayErrMesg,s,1(SACL_not_define,SAFE_E02,1))

	same => n(SACL_baro_succ), Set(ErrCode=SACL_baro_succ)
	same => n, Goto(SACL_dau_agi)

	same => n(SACL_baro_fail), Set(ErrCode=SACL_baro_fail)
	same => n, ExecIf($[${ActType} = 4}]?Playback(${wavDIR}/SAFE_103))	; 바로 DB에 착신링크를 활성화하지 못했습니다.
	same => n, ExecIf($[${ActType} = 5}]?Playback(${wavDIR}/SAFE_104))	; 바로 DB에 착신링크를 오프하지 못했습니다.
	same => n, Playback(${wavDIR}/SAFE_C07)					; 상담원에게 문의하시기 바랍니다.
	same => n, Goto(SACL_9)

	; ----------------------------------------
	; 다우 DB에 저장하기                      
	; ----------------------------------------
	same => n(SACL_dau_agi), Set(ErrCode=SACL_dau_agi)

	same => n, GoSub(safe_dau_store_SafeNumber,s,1(${ErrCode},${ActType}))	; 4=착신활성화,5=착신비활성화
	same => n, Set(RESULT=${GOSUB_RETVAL})
	same => n, GotoIf($[${RESULT} = 1]?SACL_1:SACL_9)			; // if succ then SACL_1 else SACL_9

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SACL_1), Return(1)	; // succ
	same => n(SACL_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_changeLinkYN/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;  바로 DB에 안심번호 예약 신청                                                  *
;   1. safenum_reserv_0507.php                                                   *
;      (1) input : - 발신번호                                                    *
;      (2) output: - RESULT(1111=succ,4444=fail)                                 *
;                  - m_0507_Number                                               *
;                                                                                *
; ********************************************************************************

[safe_agi_reserv_0507]
exten => s,1,Noop(safe_agi_reserv_0507 from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})

	; ----------------------------------------
	; 바로 DB에 안심번호 예약 신청                       
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_reserv_0507.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_reserv_0507.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_0507_Number=[${m_0507_Number}] )

	same => n, GoSubIf($["${AGISTATUS}"!="SUCCESS"]?comm_PlayErrMesg,s,1(SAR0_agi_fail,SAFE_E01,0))
	same => n, GotoIf($["${RESULT}" = "1111"]?SAR0_1)		; // succ
	same => n, GotoIf($["${RESULT}" = "4444"]?SAR0_fail)		; // fail
	same => n, GoSub(comm_PlayErrMesg,s,1(SAR0_not_define,SAFE_E02,1))

	same => n(SAR0_fail), Playback(${wavDIR}/SAFE_063)		; 안심번호 예약 신청이 실패하였습니다.
	same => n, Playback(${wavDIR}/SAFE_C07)				; 상담원에게 문의하시기 바랍니다.
	same => n, Goto(SAR0_9)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SAR0_1), Return(1)	; // succ
	same => n(SAR0_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_reserv_0507/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;   바로 DB에 안심번호 예약 취소                                                 *
;      safenum_cancel_0507.php                                                   *
;      (1) input : - 발신번호                                                    *
;                  - m_0507_Number                                               *
;      (2) output: - RESULT(1111=succ,4444=fail)                                 *
;                                                                                *
; ********************************************************************************

[safe_agi_cancel_0507]
exten => s,1,Noop(safe_agi_cancel_0507 from [${ARG1} )

	same => n, Set(LOCAL(ErrCode)=${ARG1})			; ErrCode

	; ----------------------------------------
	; 바로 DB에 안심번호 예약 취소                       
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_cancel_0507.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_cancel_0507.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_0507_Number=[${m_0507_Number}] )

	same => n, GotoIf($["${AGISTATUS}"!="SUCCESS"]?SAC0_9)
	same => n, GotoIf($["${RESULT}" = "1111"]?SAC0_1)		; // succ
	same => n, GotoIf($["${RESULT}" = "4444"]?SAC0_9)		; // fail
	same => n, Goto(SAC0_9)						; // fail

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SAC0_1), Return(1)	; // succ
	same => n(SAC0_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_cancel_0507/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
; 안심번호 예약 정보 취소                                                        *
;                                                                                *
; ********************************************************************************

[safenum_cancel_reserv0507]
exten => s,1,Noop(safenum_cancel_reserv0507 from [${ARG1}] )
	same => n, Set(LOCAL(ErrCode)=${ARG1})
	same => n, Set(LOCAL(rValue)=0)

	same => n, GoSub(safe_agi_cancel_0507,s,1(${ErrCode}))

	same => n, Set(rValue=${GOSUB_RETVAL})
	same => n, ExecIf($[${rValue} = 1]?Playback(${wavDIR}/SAFE_064))	; 안심번호 예약 정보를 취소하였습니다.
	same => n, ExecIf($[${rValue} = 9]?Playback(${wavDIR}/SAFE_065))	; 안심번호 예약 취소가 실패하였습니다.
	same => n, Return()

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safenum_cancel_reserv0507/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;   안심번호 등록하기                                                            *
;   1.바로 DB에 등록                                                             *
;      safenum_reg_0507.php                                                      *
;      (1) input : - 발신번호                                                    *
;                  - m_0507_Number                                               *
;                  - m_CFA_Number                                                *
;                  - m_CFA_LinkYN                                                *
;      (2) output: - RESULT(1111=succ,4444=fail)                                 *
;                                                                                *
;   2.다우 DB에 등록                                                             *
;                                                                                *
; ********************************************************************************

[safe_agi_regSafeNumber]
exten => s,1,Noop(safe_agi_regSafeNumber from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})

	; ----------------------------------------
	; 바로 DB에 등록하기                             
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_reg_0507.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_reg_0507.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_0507_Number=[${m_0507_Number}] m_CFA_Number=[${m_CFA_Number}] m_CFA_LinkYN=[${m_CFA_LinkYN}] )

	same => n, GoSubIf($["${AGISTATUS}"!="SUCCESS"]?comm_PlayErrMesg,s,1(SARS_agi_fail,SAFE_E01,5))
	same => n, GotoIf($["${AGISTATUS}"!="SUCCESS"]?SARS_9)

	same => n, GotoIf($["${RESULT}" = "1111"]?SARS_dau_agi)			; // succ
	same => n, GotoIf($["${RESULT}" = "4444"]?SARS_baro_fail)		; // fail
	same => n, GoSub(comm_PlayErrMesg,s,1(SARS_not_define,SAFE_E02,5))
	same => n, Goto(SARS_9)

	same => n(SARS_baro_fail), Set(ErrCode=SARS_baro_fail)
	same => n, Playback(${wavDIR}/SAFE_100)					; 바로 DB에 안심번호를 등록하지 못했습니다.
	same => n, Playback(${wavDIR}/SAFE_C07)					; 상담원에게 문의하시기 바랍니다.
	same => n, Goto(SARS_9)

	; ----------------------------------------
	; 다우 DB에 등록하기                      
	; ----------------------------------------
	same => n(SARS_dau_agi), Set(ErrCode=SARS_dau_agi)
	same => n, GoSub(safe_dau_store_SafeNumber,s,1(${ErrCode},1))		; 1=등록
	same => n, Set(RESULT=${GOSUB_RETVAL})
	same => n, GotoIf($[${RESULT} = 1]?SARS_1:SARS_9)			; // if succ then SARS_1 else SARS_9

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SARS_1), Return(1)	; // succ
	same => n(SARS_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_regSafeNumber/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;   안심번호 서비스 해지                                                         *
;   1.바로 DB에 서비스 해지                                                      *
;      safenum_unreg_0507.php                                                    *
;      (1) input : - 발신번호                                                    *
;                  - m_0507_Number                                               *
;      (2) output: - RESULT(1111=succ,4444=fail)                                 *
;                                                                                *
;   2.다우 DB에 서비스 해지                                                      *
;                                                                                *
; ********************************************************************************

[safe_agi_unregSafeNumber]
exten => s,1,Noop(safe_agi_unregSafeNumber from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})

	; ----------------------------------------
	; 바로 DB에서 해지하기                            
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_unreg_0507.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_unreg_0507.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_0507_Number=[${m_0507_Number}] )

	same => n, GoSubIf($["${AGISTATUS}"!="SUCCESS"]?comm_PlayErrMesg,s,1(SAUS_agi_fail,SAFE_E01,0))
	same => n, GotoIf($["${RESULT}" = "1111"]?SAUS_dau_agi)		; // succ
	same => n, GotoIf($["${RESULT}" = "4444"]?SAUS_baro_fail)	; // fail
	same => n, GoSub(comm_PlayErrMesg,s,1(SAUS_not_define,SAFE_E02,1))

	same => n(SAUS_baro_fail), Set(ErrCode=SAUS_baro_fail)
	same => n, Playback(${wavDIR}/SAFE_101)				; 바로 DB에 안심번호 서비스를 해지하지 못했습니다.
	same => n, Playback(${wavDIR}/SAFE_C07)				; 상담원에게 문의하시기 바랍니다.
	same => n, Goto(SAUS_9)

	; ----------------------------------------
	; CallMix에 해지하기                      
	; ----------------------------------------
	same => n(SAUS_dau_agi), Set(ErrCode=SAUS_dau_agi)
	same => n, Set(m_CFA_Number="")
	same => n, Set(m_CFA_LinkYN="N")
	same => n, GoSub(safe_dau_store_SafeNumber,s,1(${ErrCode},2))		; 2=해지
	same => n, Set(RESULT=${GOSUB_RETVAL})
	same => n, GotoIf($[${RESULT} = 1]?SAUS_1:SAUS_9)			; // if succ then SAUS_1 else SAUS_9

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SAUS_1), Return(1)	; // succ
	same => n(SAUS_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_unregSafeNumber/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;   결제 안내 문자 보내기                                                        *
;      safenum_send_ciderpay_sms.php                                             *
;      (1) input : - 발신번호                                                    *
;                  - m_0507_Number                                               *
;      (2) output: - RESULT(1111=succ,4444=fail)                                 *
;                                                                                *
; ********************************************************************************

[safe_agi_send_sms_pay]
exten => s,1,Noop(safe_agi_send_sms_pay from [${ARG1}/${ARG2}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_send_ciderpay_sms.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_send_ciderpay_sms.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_0507_Number=[${m_0507_Number}])

	same => n, GoSubIf($["${AGISTATUS}"!="SUCCESS"]?comm_PlayErrMesg,s,1(SMSP_agi_fail,SAFE_E03,5))

	same => n, GotoIf($["${AGISTATUS}"!="SUCCESS"]?SMSP_1)
	same => n, GotoIf($[${RESULT} = 1111]?SMSP_succ)
	same => n, GotoIf($[${RESULT} = 4444]?SMSP_fail)

	same => n, GoSub(comm_PlayErrMesg,s,1(SMSP_not_define,SAFE_E04,5))
	same => n, Goto(SMSP_1)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SMSP_succ), Set(ErrCode=SMSP_succ)
	same => n, Playback(${wavDIR}/SAFE_052)		; 고객님의 핸드폰으로 결제 요청 문자를 보냈습니다.
	                                       		; 받으신 문자에서 URL을 클릭하시면,
	                                       		; 핸드폰에서 결제를 할 수 있습니다.
	                                       		; 사이다페이 앱 화면에서 신용 카드 번호를 입력하시면,
	                                       		; 결재가 진행됩니다.
	same => n, Goto(SMSP_1)

	same => n(SMSP_fail), Set(ErrCode=SMSP_fail)
	same => n, Playback(${wavDIR}/SAFE_051)		; 결제 요청 문자를 보내는데 실패하였습니다.
	                                       		; 결제를 완성하시려면, 상담원에게 문의하십시요.
	same => n, Goto(SMSP_1)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SMSP_1), Return(1)	; // succ
	same => n(SMSP_2), Return(2)	; // fail

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_send_sms_pay/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
;                                                                                *
;   콜센터 연결 번호 가져오기                                                    *
;   safenum_get_callcenterDN.php                                                 *
;      (1) input : - 없음                                                        *
;      (2) output: - RESULT(1111=OK)                                             *
;                  - m_RegCount                                                  *
;                  - m_0507_DN0 ~ m_0507_DN9                                     *
;                                                                                *
; ********************************************************************************

[safe_agi_get_callcenterDN]
exten => s,1,Noop(safe_agi_get_callcenterDN from [${ARG1}/${ARG2}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})			; ErrCode

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n, AGI(${agiDIR}/safenum_get_callcenterDN.php)
	same => n, Log(NOTICE,[${CALLER}] safenum_get_callcenterDN.php : AGI=[${AGISTATUS}] RLT=[${RESULT}] m_ConsultantDN=[${m_ConsultantDN}])

	same => n, GotoIf($["${AGISTATUS}"!="SUCCESS"]?SAGC_2)
	same => n, GotoIf($[${RESULT} = 1111]?SAGC_1)	; // succ
	same => n, GotoIf($[${RESULT} = 2222]?SAGC_2)	; // DB에 미정의(해당 서비스 없음)-agi파일에 고정으로 정의하여 사용
	same => n, Goto(SAGC_2)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SAGC_1), Return(1)	; // succ
	same => n(SAGC_2), Return(2)	; // fail

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_agi_get_callcenterDN/Hangup ERR=[${ErrorCode} ${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; * 다음 0507 번호 가져오기                                                      *
; *                                                                              *
; ********************************************************************************

[safe_GetNext0507Number]
exten => s,1,Noop(safe_GetNextBox from [${ARG1}/${ARG2}])

	same => n, Set(LOCAL(ErrCode)=${ARG1})				; ErrCode
	same => n, Set(LOCAL(MaxCount)=${ARG2})

	same => n, Set(LOCAL(DN)=0)
	same => n, Set(countLOOP=$[${countLOOP}+1])

	same => n, ExecIf($[${countLOOP} > 10]?Set(countLOOP=1))
	same => n, ExecIf($[${countLOOP} > ${MaxCount}]?Set(countLOOP=1))

	same => n, ExecIf($[${countLOOP} = 1]?Set(m_0507_Number=${m_0507_DN0}))
	same => n, ExecIf($[${countLOOP} = 2]?Set(m_0507_Number=${m_0507_DN1}))
	same => n, ExecIf($[${countLOOP} = 3]?Set(m_0507_Number=${m_0507_DN2}))
	same => n, ExecIf($[${countLOOP} = 4]?Set(m_0507_Number=${m_0507_DN3}))
	same => n, ExecIf($[${countLOOP} = 5]?Set(m_0507_Number=${m_0507_DN4}))
	same => n, ExecIf($[${countLOOP} = 6]?Set(m_0507_Number=${m_0507_DN5}))
	same => n, ExecIf($[${countLOOP} = 7]?Set(m_0507_Number=${m_0507_DN6}))
	same => n, ExecIf($[${countLOOP} = 8]?Set(m_0507_Number=${m_0507_DN7}))
	same => n, ExecIf($[${countLOOP} = 9]?Set(m_0507_Number=${m_0507_DN8}))
	same => n, ExecIf($[${countLOOP} = 10]?Set(m_0507_Number=${m_0507_DN9}))

	same => n, Return(${m_0507_Number})




; ********************************************************************************
; *                                                                              *
; * 1. 도입부/0507 번호 선택 메뉴                                                *
; *                                                                              *
; ********************************************************************************

[safe_SelSafeNumber]
exten => s,1,Noop(safe_SelSafeNumber from [${ARG1}/${ARG2}/${ARG3}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})				; ErrCode
	same => n, Set(LOCAL(RegCount)=${ARG2})
	same => n, Set(LOCAL(DN)=${ARG3})
	same => n, Set(LOCAL(SELNUM)=0)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
;	same => n(SSSN_rcvDgt), Set(ErrCode=SSSN_rcvDgt)

	same => n, Playback(${wavDIR}/SAFE_074)				; 사용중인 안심번호가.
	same => n, GoSub(readCount,s,1(${RegCount},G));			; xx 개
	same => n, Playback(${wavDIR}/SAFE_C03)				; 있습니다.

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SSSN_rcvDgt), Set(ErrCode=SSSN_rcvDgt)

	same => n, SayDigits(${DN})					; xxxx-xxxx-xxxx
	same => n, Playback(${wavDIR}/SAFE_075)				; 를 선택하시겠습니까?

	same => n, Read(SELNUM,${wavDIR}/SAFE_010,1,n,1,5)		; 선택은 1번. 
	                                                  		; 다음 번호는 2번. 
	                                                  		; 종료 하기는 9번. 
	                                                  		; 다시 듣기는 0번을 누르세요.

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SSSN_not_enter)	; // 미입력

	same => n, GotoIf($["${SELNUM}"="0"]?SSSN_rcvDgt)		; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="1"]?SSSN_1)			; // 선택
	same => n, GotoIf($["${SELNUM}"="2"]?SSSN_next0507)		; // 다른 번호로 변경
	same => n, GotoIf($["${SELNUM}"="9"]?SSSN_9)			; // 이전 단계 --> 2-1 단계로 이동

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SSSN_wrong), Set(ErrCode=SSSN_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(SSSN_wrong,SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SSSN_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SSSN_not_enter), Set(ErrCode=SSSN_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(SSSN_not_enter,SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SSSN_rcvDgt)

	; ----------------------------------------
	; 다음 0507 번호로 선택                    
	; ----------------------------------------
	same => n(SSSN_next0507), Set(ErrCode=SSSN_next0507)
	same => n, GoSub(safe_GetNext0507Number,s,1(${ErrCode},${RegCount}))	; // 다음 0507 번호 가져오기
	same => n, Set(DN=${m_0507_Number})
	same => n, Goto(SSSN_rcvDgt)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SSSN_1), Return(1)	; // 선택
	same => n(SSSN_9), Return(2)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_SelSafeNumber/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; * 2. 등록 메뉴 안내                                                            *
; *                                                                              *
; ********************************************************************************

[safe_SelRegMenu]
exten => s,1,Noop(safe_SelRegMenu from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})				; ErrCode
	same => n, Set(LOCAL(SELNUM)=0)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SSRM_rcvDgt), Set(ErrCode=SSRM_rcvDgt)

	same => n, Read(SELNUM,${wavDIR}/SAFE_011,1,n,1,5)		; 안심 번호 등록은 1번.  
	                                                  		; 상담원 연결은 2번. 
	                                                  		; 종료 하기는 9번. 
	                                                  		; 다시 듣기는 0번을 누르세요.

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SSRM_not_enter)	; // 미입력
	same => n, GotoIf($["${SELNUM}"="0"]?SSRM_rcvDgt)		; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="1"]?SSRM_1)			; // 안심번호 등록
	same => n, GotoIf($["${SELNUM}"="2"]?SSRM_2)			; // 상담원 연결
	same => n, GotoIf($["${SELNUM}"="9"]?SSRM_9)			; // 종료하기

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SSRM_wrong), Set(ErrCode=SSRM_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(SSRM_wrong,SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SSRM_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SSRM_not_enter), Set(ErrCode=SSRM_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(SSRM_not_enter,SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SSRM_rcvDgt)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SSRM_1), Return(1)	; // 등록
	same => n(SSRM_2), Return(2)	; // 상담원 연결
	same => n(SSRM_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_SelRegMenu/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; * 3. 메인 메뉴                                                                 *
; *                                                                              *
; ********************************************************************************

[safe_SelMainMenu]
exten => s,1,Noop(safe_SelMainMenu from [${ARG1}/${ARG2}/${ARG3}/${ARG4}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})
	same => n, Set(LOCAL(RegCount)=${ARG2})
	same => n, Set(LOCAL(DN)=${ARG3})
	same => n, Set(LOCAL(MainMenuCallType)=${ARG4})			; m_MainMenuCallType
	same => n, Set(LOCAL(SELNUM)=0)

	same => n, GotoIf($[${RegCount}=1]?SSMM_one_number:SSMM_mul_number)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SSMM_one_number), Set(ErrCode=SSMM_one_number)
	same => n, Playback(${wavDIR}/SAFE_076)				; 사용 중인 안심 번호는.
	same => n, SayDigits(${DN})					; xxxx-xxxx-xxxx
	same => n, Playback(${wavDIR}/SAFE_C04)				; 입니다.
	same => n, Goto(SSMM_rcvDgt)

	same => n(SSMM_mul_number), Set(ErrCode=SSMM_mul_number)
	same => n, GotoIf($[${MainMenuCallType}=2]?SSMM_rcvDgt)		; // 종료하기
	same => n, Playback(${wavDIR}/SAFE_074)				; 사용 중인 안심 번호가.
	same => n, GoSub(readCount,s,1(${RegCount},G));			; xx 개
	same => n, Playback(${wavDIR}/SAFE_077)				; 이고, 선택한 안심번호는
	same => n, SayDigits(${DN})					; xxxx-xxxx-xxxx
	same => n, Playback(${wavDIR}/SAFE_C04)				; 입니다.
	same => n, Goto(SSMM_rcvDgt)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SSMM_rcvDgt), Set(ErrCode=SSMM_rcvDgt)

	same => n, Read(SELNUM,${wavDIR}/SAFE_012,1,n,1,5)		; 관리 안내는 1번. 
	                                                  		; 안심 번호 추가는 2번. 
	                                                  		; 안심 번호 해지는 3번. 
	                                                  		; 선택 번호 변경은 4번. 
	                                                  		; 종료 하기는 9번. 
	                                                  		; 다시 듣기는 0번을 누르세요.

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SSMM_not_enter)	; // 미입력
	same => n, GotoIf($["${SELNUM}"="0"]?SSMM_rcvDgt)		; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="1"]?SSMM_1)			; // 관리 안내
	same => n, GotoIf($["${SELNUM}"="2"]?SSMM_2)			; // 안심 번호 추가
	same => n, GotoIf($["${SELNUM}"="3"]?SSMM_3)			; // 안심 번호 해지
	same => n, GotoIf($["${SELNUM}"="4"]?SSMM_next0507)		; // 선택 번호 변경
	same => n, GotoIf($["${SELNUM}"="9"]?SSMM_9)			; // 종료하기

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SSMM_wrong), Set(ErrCode=SSMM_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SSMM_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SSMM_not_enter), Set(ErrCode=SSMM_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SSMM_rcvDgt)

	; ----------------------------------------
	; 다음 0507 번호로 선택                    
	; ----------------------------------------
	same => n(SSMM_next0507), Set(ErrCode=SSMM_next0507)
	same => n, GotoIf($[${RegCount}=1]?SSMM_rcvDgt)
	same => n, GoSub(safe_GetNext0507Number,s,1(${ErrCode},${RegCount}))	; // 다음 0507 번호 가져오기
	same => n, Set(DN=${m_0507_Number})
	same => n, Goto(SSMM_mul_number)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SSMM_1), Return(1)	; // 관리 안내
	same => n(SSMM_2), Return(2)	; // 안심 번호 추가
	same => n(SSMM_3), Return(3)	; // 안심 번호 해지
	same => n(SSMM_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_SelMainMenu/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; * 4.관리 메뉴 안내 / 안심번호의 착신 전환 정보 안내                            *
; *                                                                              *
; ********************************************************************************

[safe_AnmLinkAlwInh]
exten => s,1,Noop(safe_AnmLinkAlwInh from [${ARG1}/${m_0507_Number}/${m_CFA_Number}/${m_CFA_LinkYN}] )
	same => n, Set(LOCAL(ErrCode)=${ARG1})				; ErrCode

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n, Playback(${wavDIR}/SAFE_070)				; 고객님이 사용 중인 xxxx-xxxx-xxxx
	same => n, SayDigits(${m_0507_Number})

	same => n, Playback(${wavDIR}/SAFE_071)				; 안심 번호는 xxxx-xxxx-xxxx
	same => n, SayDigits(${m_CFA_Number})

	same => n, GotoIf($["${m_CFA_LinkYN}" = "Y"]?SLAI_alw:SLAI_inh)

	same => n(SLAI_inh), Set(ErrCode=SLAI_inh)
	same => n, Playback(${wavDIR}/SAFE_072)				; 으로 착신 전환이 등록되어 있으나,
	                                       				; 착신 전환 서비스는 중지되어 있는 상태입니다.
	same => n, Goto(SLAI_2)

	same => n(SLAI_alw), Set(ErrCode=SLAI_alw)
	same => n, Playback(${wavDIR}/SAFE_073)				; 으로 착신 전환 서비스 중입니다.
	same => n, Goto(SLAI_1)

	same => n(SLAI_1), Return(1)					; // 착신 전환 허용 상태
	same => n(SLAI_2), Return(2)					; // 착신 전환 금지 상태

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_AnmLinkAlwInh/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; * 4.관리 메뉴 안내 / 서비스 상태 안내                                          *
; *                                                                              *
; ********************************************************************************

[safe_SelManageGuide]
exten => s,1,Noop(safe_SelManageGuide from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})				; ErrCode
	same => n, Set(LOCAL(SELNUM)=0)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SSMG_playAnm), Set(ErrCode=SSMG_playAnm)
	same => n, GoSub(safe_AnmLinkAlwInh,s,1(${ErrCode}))

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SSMG_rcvDgt), Set(ErrCode=SSMG_rcvDgt)

	same => n, Read(SELNUM,${wavDIR}/SAFE_014,1,n,1,5)		; 착신 번호 변경은 1번.
	                                                  		; 안심 번호 서비스 일시 정지는 2번.
	                                                  		; 안심 번호 서비스 재개는 3번.
	                                                  		; 상담원 연결은 4번.
	                                                  		; 종료 하기는 9번.
	                                                  		; 이전 단계는 별표.
	                                                  		; 다시 듣기는 0번을 누르세요.

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SSMG_not_enter)	; // 미입력
	same => n, GotoIf($["${SELNUM}"="0"]?SSMG_playAnm)		; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="*"]?SSMG_0)			; // 이전 단계
	same => n, GotoIf($["${SELNUM}"="1"]?SSMG_1)			; // 착신 번호 변경
	same => n, GotoIf($["${SELNUM}"="2"]?SSMG_to_inh)		; // 안심 번호 서비스 일시 정지
	same => n, GotoIf($["${SELNUM}"="3"]?SSMG_to_alw)		; // 안심 번호 서비스 재개
	same => n, GotoIf($["${SELNUM}"="4"]?SSMG_4)			; // 상담원 연결
	same => n, GotoIf($["${SELNUM}"="9"]?SSMG_9)			; // 종료

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SSMG_wrong), Set(ErrCode=SSMG_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SSMG_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SSMG_not_enter), Set(ErrCode=SSMG_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SSMG_rcvDgt)

	; ----------------------------------------
	; 현재 상태 : 착신 전환 금지                 
	; ----------------------------------------
	same => n(SSMG_to_inh), Set(ErrCode=SSMG_to_inh)
	same => n, GotoIf($["${m_CFA_LinkYN}" = "Y"]?SSMG_2)
	same => n, Playback(${wavDIR}/SAFE_061)			; 선택하신 안심번호는 착신전환 서비스가 금지되어 있습니다.
	same => n, Playback(${wavDIR}/SAFE_C06)			; 다시 선택하셔야 합니다.
	same => n, Goto(SSMG_rcvDgt)

	; ----------------------------------------
	; 현재 상태 : 착신 전환 서비스중               
	; ----------------------------------------
	same => n(SSMG_to_alw), Set(ErrCode=SSMG_to_alw)
	same => n, GotoIf($["${m_CFA_LinkYN}" = "Y"]?:SSMG_3)
	same => n, Playback(${wavDIR}/SAFE_062)			; 선택하신 안심번호는 착신전환 서비스중입니다.
	same => n, Playback(${wavDIR}/SAFE_C06)			; 다시 선택하셔야 합니다.
	same => n, Goto(SSMG_rcvDgt)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SSMG_0), Return(0)	; // 이전 단계
	same => n(SSMG_1), Return(1)	; // 착신 번호 변경
	same => n(SSMG_2), Return(2)	; // 안심 번호 서비스 일시 정지
	same => n(SSMG_3), Return(3)	; // 안심 번호 서비스 재개
	same => n(SSMG_4), Return(4)	; // 상담원 연결
	same => n(SSMG_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_SelManageGuide/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; * 4.관리 메뉴 안내 / 미결제 안내                                               *
; *                                                                              *
; ********************************************************************************

[safe_AnmNotPay]
exten => s,1,Noop(safe_AnmNotPay from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})				; ErrCode
	same => n, Set(LOCAL(SELNUM)=0)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SANP_anmInfo), Set(ErrCode=SANP_anmInfo)
	same => n, Playback(${wavDIR}/SAFE_081)				; 고객님께서 등록하신 안심 번호.
	same => n, SayDigits(${m_0507_Number})				; xxxx-xxxx-xxxx 는
	same => n, Playback(${wavDIR}/SAFE_082)				; 결제가 되어 있지 않은 상태입니다.
	                                       				; 결제후 이용해 주세요.
	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SANP_rcvDgt), Set(ErrCode=SANP_rcvDgt)

	same => n, Read(SELNUM,${wavDIR}/SAFE_020,1,n,1,5)		; 안심 번호 선택은 1번.
	                                                  		; 결제 문자 받기는 2번.
	                                                  		; 상담원 연결은 3번.
	                                                  		; 종료 하기는 9번.
	                                                  		; 이전 단계는 별표.
	                                                  		; 다시 듣기는 0번을 누르세요.

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SANP_not_enter)	; // 미입력
	same => n, GotoIf($["${SELNUM}"="0"]?SANP_anmInfo)		; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="*"]?SANP_0)			; // 이전 단계
	same => n, GotoIf($["${SELNUM}"="1"]?SANP_next0507)		; // 안심 번호 선택
	same => n, GotoIf($["${SELNUM}"="2"]?SANP_2)			; // 결제 문자 받기
	same => n, GotoIf($["${SELNUM}"="3"]?SANP_3)			; // 상담원 연결
	same => n, GotoIf($["${SELNUM}"="9"]?SANP_9)			; // 종료

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SANP_wrong), Set(ErrCode=SANP_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SANP_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SANP_not_enter), Set(ErrCode=SANP_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SANP_rcvDgt)

	; ----------------------------------------
	; 다음 0507 번호로 선택                    
	; ----------------------------------------
	same => n(SANP_next0507), Set(ErrCode=SANP_next0507)
	same => n, GotoIf($[${m_RegCount} = 1]?SANP_anmInfo)

	same => n, GoSub(safe_GetNext0507Number,s,1(${ErrCode},${m_RegCount}))	; // 다음 0507 번호 가져오기

	same => n, Set(m_MainMenuCallType=2)
	same => n, GoSub(safe_SelSafeNumber,s,1(${ErrCode},${m_RegCount},${m_0507_Number}))
	same => n, Set(RESULT=${GOSUB_RETVAL})
	same => n, GotoIf($[${RESULT} = 1]?SANP_1)			; // 메인 메뉴로 이동
	same => n, Goto(SANP_9)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SANP_0), Return(0)	; // 이전 단계
	same => n(SANP_1), Return(1)	; // 안심 번호 선택  
	same => n(SANP_2), Return(2)	; // 결제 문자 받기
	same => n(SANP_3), Return(3)	; // 상담원 연결
	same => n(SANP_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_AnmNotPay/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; * 5.착신 번호 변경 / 착신 번호 입력                                            *
; *                                                                              *
; ********************************************************************************

[safe_changeCfaDN]
exten => s,1,Noop(safe_changeCfaDN from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})
	same => n, Set(LOCAL(CfaDN)=0)
	same => n, Set(LOCAL(SELNUM)=0)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SCCD_init), Set(ErrCode=SCCD_init)
	same => n, Set(countWRONG=0)
	same => n, Set(countENTER=0)

	; ----------------------------------------
	; 착신전환 번호 입력                              
	; ----------------------------------------
	same => n(SCCD_rcvCfaDN), Set(ErrCode=SCCD_rcvCfaDN)

	same => n, Read(CfaDN,${wavDIR}/SAFE_031,13,n,1,10)		; 입력 가능한 전화 번호는 최대 12자리 입니다.
	                                                  		; 착신하고자 하는 번호를 입력하세요.
	                                                  		; 번호 입력이 완료되면, 샾 버튼을 누르세요.

	same => n, GotoIf($[${LEN(${CfaDN})} = 0]?SCCD_no_cfadn)	; // 미입력
	same => n, GotoIf($[${LEN(${CfaDN})} >12]?SCCD_over_max)	; // 최대 길이 초과

	same => n, Set(countWRONG=0)
	same => n, Set(countENTER=0)
	same => n, Goto(SCCD_rcvDgt)

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SCCD_over_max), Set(ErrCode=SCCD_over_max)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SCCD_rcvCfaDN)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SCCD_no_cfadn), Set(ErrCode=SCCD_no_cfadn)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SCCD_rcvCfaDN)

	; ----------------------------------------
	; 입력 번호 확인 안내                             
	; ----------------------------------------
	same => n(SCCD_rcvDgt), Set(ErrCode=SCCD_rcvDgt)

	same => n, Playback(${wavDIR}/SAFE_080)				; 입력하신 전화 번호는 xxxx-xxxx-xxxx
	same => n, SayDigits(${CfaDN})
	same => n, Playback(${wavDIR}/SAFE_C04)				; 입니다.

	; ----------------------------------------
	; 메뉴 선택                                   
	; ----------------------------------------
	same => n, Read(SELNUM,${wavDIR}/SAFE_015,1,n,1,5)		; 맞으면 1번. 
	                                                  		; 재입력은 2번.
	                                                  		; 종료 하기는 9번.
	                                                  		; 상위 메뉴로 이동은 별표.
	                                                  		; 다시 듣기는 0번을 누르세요.

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SCCD_not_enter)	; // 미입력
	same => n, GotoIf($["${SELNUM}"="0"]?SCCD_rcvDgt)		; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="*"]?SCCD_0)			; // 이전 단계
	same => n, GotoIf($["${SELNUM}"="1"]?SCCD_ok)			; // 선택
	same => n, GotoIf($["${SELNUM}"="2"]?SCCD_init)			; // 재입력
	same => n, GotoIf($["${SELNUM}"="9"]?SCCD_9)			; // 종료

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SCCD_wrong), Set(ErrCode=SCCD_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SCCD_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SCCD_not_enter), Set(ErrCode=SCCD_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SCCD_rcvDgt)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SCCD_ok), Set(ErrCode=SCCD_ok)
	same => n, Set(m_CFA_Number=${CfaDN})
	same => n, Goto(SCCD_1)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SCCD_0), Return(0)	; // 이전 단계
	same => n(SCCD_1), Return(1)	; // 선택  
	same => n(SCCD_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_changeCfaDN/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; *  6. 서비스 일시 정지 / 서비스 안내 메뉴                                      *
; *                                                                              *
; ********************************************************************************

[safe_MenuInhCFA]
exten => s,1,Noop(safe_MenuInhCFA from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})				; ErrCode
	same => n, Set(LOCAL(SELNUM)=0)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SMIC_rcvDgt), Set(ErrCode=SMIC_rcvDgt)

	same => n, Read(SELNUM,${wavDIR}/SAFE_016,1,n,1,5)		; 안심 번호 서비스 일시 정지는 1번.
	                                                  		; 종료 하기는 9번.
	                                                  		; 이전 단계는 별표.
	                                                  		; 다시 듣기는 0번을 누르세요. 

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SMIC_not_enter)	; // 미입력
	same => n, GotoIf($["${SELNUM}"="0"]?SMIC_rcvDgt)		; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="*"]?SMIC_0)			; // 이전 단계
	same => n, GotoIf($["${SELNUM}"="1"]?SMIC_1)			; // 일시 정지
	same => n, GotoIf($["${SELNUM}"="9"]?SMIC_9)			; // 종료

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SMIC_wrong), Set(ErrCode=SMIC_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SMIC_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SMIC_not_enter), Set(ErrCode=SMIC_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SMIC_rcvDgt)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SMIC_0), Return(0)	; // 이전 단계
	same => n(SMIC_1), Return(1)	; // 일시 정지
	same => n(SMIC_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_MenuInhCFA/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; *  7. 서비스 재개 / 서비스 안내 메뉴                                           *
; *                                                                              *
; ********************************************************************************

[safe_MenuAlwCFA]
exten => s,1,Noop(safe_MenuAlwCFA from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})
	same => n, Set(LOCAL(SELNUM)=0)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SMAC_rcvDgt), Set(ErrCode=SMAC_rcvDgt)

	same => n, Read(SELNUM,${wavDIR}/SAFE_017,1,n,1,5)		; 안심 번호 서비스 재개는 1번.
	                                                  		; 종료 하기는 9번.
	                                                  		; 이전 단계는 별표.
	                                                  		; 다시 듣기는 0번을 누르세요. 

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SMAC_not_enter)	; // 미입력
	same => n, GotoIf($["${SELNUM}"="0"]?SMAC_rcvDgt)		; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="*"]?SMAC_0)			; // 이전 단계
	same => n, GotoIf($["${SELNUM}"="1"]?SMAC_1)			; // 서비스 재개
	same => n, GotoIf($["${SELNUM}"="9"]?SMAC_9)			; // 종료

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SMAC_wrong), Set(ErrCode=SMAC_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SMAC_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SMAC_not_enter), Set(ErrCode=SMAC_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SMAC_rcvDgt)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SMAC_0), Return(0)	; // 이전 단계
	same => n(SMAC_1), Return(1)	; // 서비스 재개
	same => n(SMAC_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_MenuAlwCFA/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; *  8. 안심 번호 등록 / 등록 메뉴 안내                                          *
; *                                                                              *
; ********************************************************************************

[safe_menu_RegSafeNumber]
exten => s,1,Noop(safe_menu_RegSafeNumber from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})
	same => n, Set(LOCAL(SELNUM)=0)

	same => n, GotoIf($[${m_RegCount} == 0]?SRSN_rcvDgt)
	same => n, GotoIf($[${m_RegCount} >= 10]?SRSN_full)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n, Playback(${wavDIR}/SAFE_078)				; 고객님께서 사용중인 안심 번호는.
	same => n, GoSub(readCount,s,1(${m_RegCount},G));		; xx 개
	same => n, Playback(${wavDIR}/SAFE_C04)				; 입니다.

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SRSN_rcvDgt), Set(ErrCode=SRSN_rcvDgt)

	same => n, Read(SELNUM,${wavDIR}/SAFE_018,1,n,1,5)		; 안심 번호 등록은 1번.
	                                                  		; 종료 하기는 9번.
	                                                  		; 이전 단계는 별표.
	                                                  		; 다시 듣기는 0번을 누르세요. 

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SRSN_not_enter)	; // 미입력
	same => n, GotoIf($["${SELNUM}"="0"]?SRSN_rcvDgt)		; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="*"]?SRSN_PreStep)		; // 이전 단계
	same => n, GotoIf($["${SELNUM}"="1"]?SRSN_1)			; // 안심번호 등록
	same => n, GotoIf($["${SELNUM}"="9"]?SRSN_9)			; // 종료

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SRSN_wrong), Set(ErrCode=SRSN_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SRSN_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SRSN_not_enter), Set(ErrCode=SRSN_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SRSN_rcvDgt)

	; ----------------------------------------
	; 0507 번호 10개를 안심번호로 사용중      
	; ----------------------------------------
	same => n(SRSN_full), Set(ErrCode=SRSN_full)
	same => n, Playback(${wavDIR}/SAFE_032)				; 안심 번호 서비스로 사용할 수 있는 번호는 
	                                       				; 최대 10개 까지이고,
	                                       				; 고객님은 더 이상 등록할 수 없습니다.
	same => n, Goto(SRSN_0)

	; ----------------------------------------
	; 이전 단계 선택                          
	; ----------------------------------------
	same => n(SRSN_PreStep), Set(ErrCode=SRSN_PreStep)
	same => n, GotoIf($[${m_RegCount} > 0]?SRSN_0)
	same => n, Playback(${wavDIR}/SAFE_C08)				; 이동할 수 있는 이전 단계가 없습니다.
	same => n, Goto(SRSN_rcvDgt)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SRSN_0), Return(0)	; // 이전 단계
	same => n(SRSN_1), Return(1)	; // 안심번호 등록
	same => n(SRSN_2), Return(2)	; // 안심번호 등록 불가
	same => n(SRSN_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_menu_RegSafeNumber/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; * etc. 계속 진행 의사 확인하기                                                 *
; *                                                                              *
; ********************************************************************************

[safe_Continue]
exten => s,1,Noop(safe_Continue from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})
	same => n, Set(LOCAL(SELNUM)=0)
	same => n, Set(LOCAL(cntNoKEY)=0)

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(CCTN_rcvDgt), Set(ErrCode=CCTN_rcvDgt)

	same => n, Read(SELNUM,${wavDIR}/SAFE_066,1,n,1,5)		; 계속해서 안심번호 ARS 서비스를 이용하시려면,
	                                                  		; 1번을 누르세요.

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?CCTN_not_enter)	; // 미입력
	same => n, GotoIf($["${SELNUM}"="1"]?CCTN_1)			; // 계속 이용하기
	same => n, Goto(CCTN_9)						; // 종료

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(CCTN_not_enter), Set(ErrCode=CCTN_not_enter)
	same => n, Set(cntNoKEY=$[${cntNoKEY}+1])
	same => n, GotoIF($[${cntNoKEY} < 3]?:CCTN_9)
	same => n, Goto(CCTN_rcvDgt)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(CCTN_1), Return(1)	; // 계속 진행  
	same => n(CCTN_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_Continue/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()




; ********************************************************************************
; *                                                                              *
; * 9.안심 번호 해지 /  해지 메뉴 안내                                           *
; *                                                                              *
; ********************************************************************************

[safe_menu_UnregSafeNumber]
exten => s,1,Noop(safe_menu_UnregSafeNumber from [${ARG1}] )

	same => n, Set(LOCAL(ErrCode)=${ARG1})
	same => n, Set(LOCAL(SELNUM)=0)

	; ----------------------------------------
	; 서비스 상태 안내                               
	; ----------------------------------------
	same => n, GotoIf($[${m_RegCount} > 0]?SDSN_anmInfo)
	same => n, Playback(${wavDIR}/SAFE_044)			; 고객님께서 사용중인 안심 번호는 없습니다.
	                                       			; 먼저 안심 번호 서비스를 등록하시기 바랍니다.
	same => n, Goto(SDSN_2)					; // 안심 번호 서비스 등록으로 이동

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SDSN_anmInfo), Set(ErrCode=SDSN_anmInfo)
	same => n, Playback(${wavDIR}/SAFE_078)			; 고객님께서 사용중인 안심 번호는.
	same => n, GoSub(readCount,s,1(${m_RegCount},G));	; xx 개
	same => n, Playback(${wavDIR}/SAFE_C03)			; 있습니다.

	same => n, Playback(${wavDIR}/SAFE_079)			; 현재 안심 번호 서비스를 해지하기 위하여 선택한 번호는.
	same => n, SayDigits(${m_0507_Number})			; xxxx-xxxx-xxxx
	same => n, Playback(${wavDIR}/SAFE_C04)			; 입니다.

	; ----------------------------------------
	;                                         
	; ----------------------------------------
	same => n(SDSN_rcvDgt), Set(ErrCode=SDSN_rcvDgt)

	same => n, Read(SELNUM,${wavDIR}/SAFE_019,1,n,1,5)	; 안심 번호 서비스 해지는 1번.
	                                                  	; 다른 번호 선택은 2번.
	                                                  	; 종료 하기는 9번.
	                                                  	; 이전 단계는 별표.
	                                                  	; 다시 듣기는 0번을 누르세요.

	same => n, GotoIf($[${LEN(${SELNUM})}=0]?SDSN_not_enter); // 미입력
	same => n, GotoIf($["${SELNUM}"="0"]?SDSN_anmInfo)	; // 다시 듣기
	same => n, GotoIf($["${SELNUM}"="*"]?SDSN_0)		; // 이전 단계
	same => n, GotoIf($["${SELNUM}"="1"]?SDSN_1)		; // 안심 번호 서비스 해지
	same => n, GotoIf($["${SELNUM}"="2"]?SDSN_next0507)	; // 다른 안심 번호 선택
	same => n, GotoIf($["${SELNUM}"="9"]?SDSN_9)		; // 종료

	; ----------------------------------------
	; 입력 정보 오류                          
	; ----------------------------------------
	same => n(SDSN_wrong), Set(ErrCode=SDSN_wrong)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C01,2))	; 잘못 눌렀습니다.
	same => n, Goto(SDSN_rcvDgt)

	; ----------------------------------------
	; 입력된 정보 없음                        
	; ----------------------------------------
	same => n(SDSN_not_enter), Set(ErrCode=SDSN_not_enter)
	same => n, GoSub(comm_PlayErrMesg,s,1(${ErrCode},SAFE_C02,3))	; 입력된 정보가 없습니다.
	same => n, Goto(SDSN_rcvDgt)

	; ----------------------------------------
	; 다음 0507 번호로 선택                    
	; ----------------------------------------
	same => n(SDSN_next0507), Set(ErrCode=SDSN_next0507)
	same => n, GotoIf($[${m_RegCount} = 1]?SDSN_anmInfo)

	same => n, GoSub(safe_GetNext0507Number,s,1(${ErrCode},${m_RegCount}))	; // 다음 0507 번호 가져오기

	same => n, GoSub(safe_SelSafeNumber,s,1(${ErrCode},${m_RegCount},${m_0507_Number}))
	same => n, Set(RESULT=${GOSUB_RETVAL})
	same => n, GotoIf($[${RESULT} = 1]?SDSN_1)
	same => n, Goto(SDSN_9)

	; ----------------------------------------
	;                                        
	; ----------------------------------------
	same => n(SDSN_0), Return(0)	; // 이전 단계
	same => n(SDSN_1), Return(1)	; // 안심 번호 서비스 해지
	same => n(SDSN_2), Return(2)	; // 안심 번호 서비스 등록으로 이동
	same => n(SDSN_9), Return(9)	; // 종료

exten => h,1, Log(NOTICE,[${CALLER} --> ${CALLEE}] safe_menu_UnregSafeNumber/Hangup ERR=[${ErrorCode}/${ErrCode}] )
	same => n, Hangup()



